import streamlit as st
import pandas as pd
import numpy as np
from datetime import datetime, timedelta
import plotly.express as px
import plotly.graph_objects as go
from io import BytesIO
import json

st.set_page_config(page_title="ูุธุงู ุงูุชุญููู ุงูุงุญุชุฑุงูู ุงูุดุงูู", layout="wide", initial_sidebar_state="expanded")

# Custom CSS ููุชูุณูู ุงูุงุญุชุฑุงูู
st.markdown("""
<style>
    .main-header {
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        padding: 2rem;
        border-radius: 10px;
        color: white;
        text-align: center;
        margin-bottom: 2rem;
    }
    .metric-card {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        text-align: center;
    }
    .stButton>button {
        width: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 0.75rem;
        border-radius: 5px;
        font-weight: bold;
    }
</style>
""", unsafe_allow_html=True)

# ุงูุนููุงู ุงูุฑุฆูุณู
st.markdown('<div class="main-header"><h1>๐ฏ ูุธุงู ุงูุชุญููู ุงูุงุญุชุฑุงูู ุงูุดุงูู</h1><p>320 ุชุญููู ูุชูุฏู ูุน ุชูุงุฑูุฑ AI ูุชุตุฏูุฑ PDF</p></div>', unsafe_allow_html=True)

# ุชุนุฑูู ุฌููุน ุงููุฌููุนุงุช ุงูู32 ุจุงูุชูุตูู ุงููุงูู
ANALYSIS_GROUPS = {
    "ุงููุฌููุนุฉ 1: ุชุญููู ุงููุจูุนุงุช ุงูุฃุณุงุณู": {
        "range": (1, 10),
        "analyses": {
            1: {"name": "ุฅุฌูุงูู ุงููุจูุนุงุช", "cols": ["ุงููููุฉ", "ุณุนุฑ_ุงูุจูุน"]},
            2: {"name": "ุฅุฌูุงูู ุงูุฃุฑุจุงุญ", "cols": ["ุงููููุฉ", "ุณุนุฑ_ุงูุจูุน", "ุงูุชูููุฉ"]},
            3: {"name": "ุฃูุถู 10 ููุชุฌุงุช ูุจูุนูุง", "cols": ["ุงูููุชุฌ", "ุงููููุฉ", "ุณุนุฑ_ุงูุจูุน"]},
            4: {"name": "ุฃูู 10 ููุชุฌุงุช ูุจูุนูุง", "cols": ["ุงูููุชุฌ", "ุงููููุฉ", "ุณุนุฑ_ุงูุจูุน"]},
            5: {"name": "ุชุญููู ุงููุจูุนุงุช ุญุณุจ ุงูููุทูุฉ", "cols": ["ุงูููุทูุฉ", "ุงููููุฉ", "ุณุนุฑ_ุงูุจูุน"]},
            6: {"name": "ุชุญููู ุงููุจูุนุงุช ุญุณุจ ุงููุฆุฉ", "cols": ["ุงููุฆุฉ", "ุงููููุฉ", "ุณุนุฑ_ุงูุจูุน"]},
            7: {"name": "ุชุญููู ุงููุจูุนุงุช ุญุณุจ ุงูุนููู", "cols": ["ุงูุนููู", "ุงููููุฉ", "ุณุนุฑ_ุงูุจูุน"]},
            8: {"name": "ุชุญููู ุงููุจูุนุงุช ุญุณุจ ุงูุดูุฑ", "cols": ["ุงูุชุงุฑูุฎ", "ุงููููุฉ", "ุณุนุฑ_ุงูุจูุน"]},
            9: {"name": "ุชุญููู ุงููุจูุนุงุช ุญุณุจ ุงูููู", "cols": ["ุงูุชุงุฑูุฎ", "ุงููููุฉ", "ุณุนุฑ_ุงูุจูุน"]},
            10: {"name": "ุชุญููู ุงููุจูุนุงุช ุญุณุจ ุงูุฑุจุน ุงููุงูู", "cols": ["ุงูุชุงุฑูุฎ", "ุงููููุฉ", "ุณุนุฑ_ุงูุจูุน"]}
        }
    },
    "ุงููุฌููุนุฉ 2: ุชุญููู ุงููุจูุนุงุช ุงููุชูุฏู": {
        "range": (11, 20),
        "analyses": {
            11: {"name": "ูุนุฏู ุงูุฑุจุญ ููู ููุชุฌ", "cols": ["ุงูููุชุฌ", "ุณุนุฑ_ุงูุจูุน", "ุงูุชูููุฉ", "ุงููููุฉ"]},
            12: {"name": "ูุนุฏู ุงูุฑุจุญ ููู ูุฆุฉ", "cols": ["ุงููุฆุฉ", "ุณุนุฑ_ุงูุจูุน", "ุงูุชูููุฉ", "ุงููููุฉ"]},
            13: {"name": "ุชุญููู ูุชูุณุท ุณุนุฑ ุงูุจูุน", "cols": ["ุงูููุชุฌ", "ุณุนุฑ_ุงูุจูุน"]},
            14: {"name": "ุชุญููู ูุงูุด ุงูุฑุจุญ ููู ููุชุฌ", "cols": ["ุงูููุชุฌ", "ุณุนุฑ_ุงูุจูุน", "ุงูุชูููุฉ"]},
            15: {"name": "ุชุญููู ุงููุจูุนุงุช ุญุณุจ ุงูููุงุฉ", "cols": ["ุงูููุงุฉ", "ุงููููุฉ", "ุณุนุฑ_ุงูุจูุน"]},
            16: {"name": "ุชุญููู ุงููุจูุนุงุช ุญุณุจ ุงููุฎุฒูู", "cols": ["ุงูููุชุฌ", "ุงููููุฉ", "ุงููุฎุฒูู"]},
            17: {"name": "ุชุญููู ุงููุจูุนุงุช ุงูููุณููุฉ", "cols": ["ุงูุชุงุฑูุฎ", "ุงููููุฉ", "ุณุนุฑ_ุงูุจูุน"]},
            18: {"name": "ุชุญููู ุงููุจูุนุงุช ุญุณุจ ุงูุชุฑููุฌ", "cols": ["ุงูุชุฑููุฌ", "ุงููููุฉ", "ุณุนุฑ_ุงูุจูุน"]},
            19: {"name": "ุชุญููู ุงููุจูุนุงุช ุงูููููุฉ", "cols": ["ุงูุชุงุฑูุฎ", "ุงููููุฉ", "ุณุนุฑ_ุงูุจูุน"]},
            20: {"name": "ุชุญููู ุงููุจูุนุงุช ุงูุฃุณุจูุนูุฉ", "cols": ["ุงูุชุงุฑูุฎ", "ุงููููุฉ", "ุณุนุฑ_ุงูุจูุน"]}
        }
    },
    "ุงููุฌููุนุฉ 3: ุชุญููู ุงููุฎุฒูู ุงูุฃุณุงุณู": {
        "range": (21, 30),
        "analyses": {
            21: {"name": "ุฅุฌูุงูู ุงููุฎุฒูู", "cols": ["ุงููููุฉ_ุงูุญุงููุฉ"]},
            22: {"name": "ุงููุฎุฒูู ุญุณุจ ุงูููุชุฌ", "cols": ["ุงูููุชุฌ", "ุงููููุฉ_ุงูุญุงููุฉ"]},
            23: {"name": "ุงููุฎุฒูู ุญุณุจ ุงููุฆุฉ", "cols": ["ุงููุฆุฉ", "ุงููููุฉ_ุงูุญุงููุฉ"]},
            24: {"name": "ุงููุฎุฒูู ุญุณุจ ุงููุณุชูุฏุน", "cols": ["ุงููุณุชูุฏุน", "ุงููููุฉ_ุงูุญุงููุฉ"]},
            25: {"name": "ุงูููุชุฌุงุช ููุฎูุถุฉ ุงููุฎุฒูู", "cols": ["ุงูููุชุฌ", "ุงููููุฉ_ุงูุญุงููุฉ", "ุงูุญุฏ_ุงูุฃุฏูู"]},
            26: {"name": "ุงูููุชุฌุงุช ุนุงููุฉ ุงููุฎุฒูู", "cols": ["ุงูููุชุฌ", "ุงููููุฉ_ุงูุญุงููุฉ", "ุงูุญุฏ_ุงูุฃูุตู"]},
            27: {"name": "ูุนุฏู ุฏูุฑุงู ุงููุฎุฒูู", "cols": ["ุงูููุชุฌ", "ุงููููุฉ_ุงูุญุงููุฉ", "ุงููุจูุนุงุช_ุงูุดูุฑูุฉ"]},
            28: {"name": "ุงููุฎุฒูู ุงููุชููุน", "cols": ["ุงูููุชุฌ", "ุงููููุฉ_ุงูุญุงููุฉ", "ุงููุจูุนุงุช_ุงูุดูุฑูุฉ"]},
            29: {"name": "ุงููุฎุฒูู ุงูุฃููู", "cols": ["ุงูููุชุฌ", "ุงูุญุฏ_ุงูุฃุฏูู"]},
            30: {"name": "ุชุญููู ุงูููุชุฌุงุช ุงููุชูุงุฏูุฉ", "cols": ["ุงูููุชุฌ", "ุงููููุฉ_ุงูุญุงููุฉ", "ุชุงุฑูุฎ_ุงูุฅุถุงูุฉ"]}
        }
    },
    "ุงููุฌููุนุฉ 4: ุชุญููู ุงููุฎุฒูู ุงููุชูุฏู": {
        "range": (31, 40),
        "analyses": {
            31: {"name": "ุชุญููู ุงูููุชุฌุงุช ุญุณุจ ุงูุนูุฑ ูู ุงููุฎุฒูู", "cols": ["ุงูููุชุฌ", "ุชุงุฑูุฎ_ุงูุฅุถุงูุฉ", "ุงููููุฉ_ุงูุญุงููุฉ"]},
            32: {"name": "ุชุญููู ุงูููุชุฌุงุช ุญุณุจ ุงููุจูุนุงุช", "cols": ["ุงูููุชุฌ", "ุงููููุฉ_ุงูุญุงููุฉ", "ุงููุจูุนุงุช_ุงูููููุฉ"]},
            33: {"name": "ุชุญููู ุงูุทูุจ ุงููุณุชูุจูู", "cols": ["ุงูููุชุฌ", "ุงููุจูุนุงุช_ุงูููููุฉ", "ุงููููุฉ_ุงูุญุงููุฉ"]},
            34: {"name": "ุงููุฎุฒูู ุญุณุจ ุงูููุฑุฏ", "cols": ["ุงูููุฑุฏ", "ุงููููุฉ_ุงูุญุงููุฉ"]},
            35: {"name": "ุงููุฎุฒูู ุญุณุจ ุงูููุทูุฉ", "cols": ["ุงูููุทูุฉ", "ุงููููุฉ_ุงูุญุงููุฉ"]},
            36: {"name": "ุชุญููู ุงููุฎุฒูู ุจูุงุกู ุนูู ุงูููุณู", "cols": ["ุงูููุณู", "ุงููููุฉ_ุงูุญุงููุฉ", "ุงูููุชุฌ"]},
            37: {"name": "ุงููุฎุฒูู ุญุณุจ ุณุนุฑ ุงูุจูุน", "cols": ["ุงูููุชุฌ", "ุณุนุฑ_ุงูุจูุน", "ุงููููุฉ_ุงูุญุงููุฉ"]},
            38: {"name": "ูุนุฏู ุงุณุชููุงู ุงููุฎุฒูู", "cols": ["ุงูููุชุฌ", "ุงููููุฉ_ุงูุญุงููุฉ", "ุงููุจูุนุงุช_ุงูููููุฉ"]},
            39: {"name": "ุชุญููู ุงูุทูุจ ููุงุจู ุงููุฎุฒูู", "cols": ["ุงูููุชุฌ", "ุงููููุฉ_ุงูุญุงููุฉ", "ุงููุจูุนุงุช_ุงูููููุฉ"]},
            40: {"name": "ุงููุฎุฒูู ุญุณุจ ุงููุฆุฉ ุงูุนููุง", "cols": ["ุงููุฆุฉ", "ุงููููุฉ_ุงูุญุงููุฉ"]}
        }
    },
    "ุงููุฌููุนุฉ 5: ุชุญููู ุงูููุธููู ุงูุฃุณุงุณู": {
        "range": (41, 50),
        "analyses": {
            41: {"name": "ุนุฏุฏ ุงูููุธููู ุญุณุจ ุงููุณู", "cols": ["ุงููุณู", "ุงูููุธู"]},
            42: {"name": "ุนุฏุฏ ุงูููุธููู ุญุณุจ ุงูุฏูุฑ", "cols": ["ุงูุฏูุฑ", "ุงูููุธู"]},
            43: {"name": "ูุชูุณุท ุงูุฑุงุชุจ ุญุณุจ ุงููุณู", "cols": ["ุงููุณู", "ุงูุฑุงุชุจ"]},
            44: {"name": "ูุชูุณุท ุงูุฑุงุชุจ ุญุณุจ ุงูุฏูุฑ", "cols": ["ุงูุฏูุฑ", "ุงูุฑุงุชุจ"]},
            45: {"name": "ุงูุชูุธูู ุงูุดูุฑู", "cols": ["ุชุงุฑูุฎ_ุงูุชูุธูู", "ุงูููุธู"]},
            46: {"name": "ูุนุฏู ุงูุงุณุชูุงูุงุช", "cols": ["ุชุงุฑูุฎ_ุงูุงุณุชูุงูุฉ", "ุงูููุธู"]},
            47: {"name": "ุชุญููู ุงูุบูุงุจ", "cols": ["ุงูููุธู", "ุฃูุงู_ุงูุบูุงุจ"]},
            48: {"name": "ุชุญููู ุงูุญุถูุฑ", "cols": ["ุงูููุธู", "ุฃูุงู_ุงูุญุถูุฑ"]},
            49: {"name": "ุชุญููู ุงูุนูุฑ ุงููุธููู", "cols": ["ุงูููุธู", "ุชุงุฑูุฎ_ุงูุชูุธูู"]},
            50: {"name": "ุชุญููู ุงูููุธููู ุงูุฌุฏุฏ", "cols": ["ุงูููุธู", "ุชุงุฑูุฎ_ุงูุชูุธูู"]}
        }
    },
    "ุงููุฌููุนุฉ 6: ุชุญููู ุงูููุธููู ุงููุชูุฏู": {
        "range": (51, 60),
        "analyses": {
            51: {"name": "ุฃุนูู ุงูุฑูุงุชุจ", "cols": ["ุงูููุธู", "ุงูุฑุงุชุจ"]},
            52: {"name": "ุฃูู ุงูุฑูุงุชุจ", "cols": ["ุงูููุธู", "ุงูุฑุงุชุจ"]},
            53: {"name": "ุชูุฒูุน ุงูุฑูุงุชุจ", "cols": ["ุงูุฑุงุชุจ"]},
            54: {"name": "ุชูููู ุงูุฃุฏุงุก ุงูุณููู", "cols": ["ุงูููุธู", "ุชูููู_ุงูุฃุฏุงุก"]},
            55: {"name": "ุงูุฃุฏุงุก ุญุณุจ ุงููุณู", "cols": ["ุงููุณู", "ุชูููู_ุงูุฃุฏุงุก"]},
            56: {"name": "ุงูุฃุฏุงุก ุญุณุจ ุงูุฏูุฑ", "cols": ["ุงูุฏูุฑ", "ุชูููู_ุงูุฃุฏุงุก"]},
            57: {"name": "ูุชูุณุท ุงูุบูุงุจ ุญุณุจ ุงููุณู", "cols": ["ุงููุณู", "ุฃูุงู_ุงูุบูุงุจ"]},
            58: {"name": "ูุชูุณุท ุงูุบูุงุจ ุญุณุจ ุงูุฏูุฑ", "cols": ["ุงูุฏูุฑ", "ุฃูุงู_ุงูุบูุงุจ"]},
            59: {"name": "ูุชูุณุท ุงูุนูุฑ ุงููุธููู", "cols": ["ุชุงุฑูุฎ_ุงูุชูุธูู"]},
            60: {"name": "ุชุญููู ุงูููุธููู ุงููุณุชูุฏููู ููุชุฑููุฉ", "cols": ["ุงูููุธู", "ูุคูู_ููุชุฑููุฉ"]}
        }
    },
    "ุงููุฌููุนุฉ 7: ุชุญููู ุงูุนููุงุก ุงูุฃุณุงุณู": {
        "range": (61, 70),
        "analyses": {
            61: {"name": "ุนุฏุฏ ุงูุนููุงุก ุงูููู", "cols": ["ุงูุนููู"]},
            62: {"name": "ุงูุนููุงุก ุงูุฌุฏุฏ", "cols": ["ุงูุนููู", "ุชุงุฑูุฎ_ุงูุชุณุฌูู"]},
            63: {"name": "ุงูุนููุงุก ุงููุดุทูู", "cols": ["ุงูุนููู", "ุขุฎุฑ_ุนูููุฉ_ุดุฑุงุก"]},
            64: {"name": "ุงูุนููุงุก ุบูุฑ ุงููุดุทูู", "cols": ["ุงูุนููู", "ุขุฎุฑ_ุนูููุฉ_ุดุฑุงุก"]},
            65: {"name": "ุฃูุถู ุงูุนููุงุก ุญุณุจ ุงููุจูุนุงุช", "cols": ["ุงูุนููู", "ุฅุฌูุงูู_ุงููุดุชุฑูุงุช"]},
            66: {"name": "ุฃูู ุงูุนููุงุก ุญุณุจ ุงููุจูุนุงุช", "cols": ["ุงูุนููู", "ุฅุฌูุงูู_ุงููุดุชุฑูุงุช"]},
            67: {"name": "ุงูุนููุงุก ุญุณุจ ุงูููุทูุฉ", "cols": ["ุงูููุทูุฉ", "ุงูุนููู"]},
            68: {"name": "ุงูุนููุงุก ุญุณุจ ุงููุฆุฉ", "cols": ["ุงููุฆุฉ", "ุงูุนููู"]},
            69: {"name": "ุงูุนููุงุก ุญุณุจ ุงูุนูุฑ", "cols": ["ุงูุนูุฑ", "ุงูุนููู"]},
            70: {"name": "ุงูุนููุงุก ุญุณุจ ุงูุฌูุณ", "cols": ["ุงูุฌูุณ", "ุงูุนููู"]}
        }
    },
    "ุงููุฌููุนุฉ 8: ุชุญููู ุงูุนููุงุก ุงููุชูุฏู": {
        "range": (71, 80),
        "analyses": {
            71: {"name": "ูุนุฏู ุงูุงุญุชูุงุธ ุจุงูุนููุงุก", "cols": ["ุงูุนููู", "ุชุงุฑูุฎ_ุงูุชุณุฌูู", "ุขุฎุฑ_ุนูููุฉ_ุดุฑุงุก"]},
            72: {"name": "ูุนุฏู ููุฏุงู ุงูุนููุงุก", "cols": ["ุงูุนููู", "ุขุฎุฑ_ุนูููุฉ_ุดุฑุงุก"]},
            73: {"name": "ุงูุนููุงุก ุงููุญุชูููู", "cols": ["ุงูุนููู", "ุญุงูุฉ_ุงูุนููู"]},
            74: {"name": "ูุนุฏู ุงูุชุญููู ูู Lead ุฅูู ุนููู", "cols": ["ุงูุนููู", "ุญุงูุฉ_ุงูุนููู"]},
            75: {"name": "ูุชูุณุท ุงูุฅููุงู ููู ุนููู", "cols": ["ุงูุนููู", "ุฅุฌูุงูู_ุงููุดุชุฑูุงุช"]},
            76: {"name": "ุงูุนููุงุก ุงูุนุงุฆุฏูู", "cols": ["ุงูุนููู", "ุนุฏุฏ_ุงููุดุชุฑูุงุช"]},
            77: {"name": "ุงูุนููุงุก ุงูุฐูู ูู ูุดุชุฑูุง ููุฐ ูุชุฑุฉ", "cols": ["ุงูุนููู", "ุขุฎุฑ_ุนูููุฉ_ุดุฑุงุก"]},
            78: {"name": "ุงูุนููุงุก ุญุณุจ ุงูุชูุงุนู", "cols": ["ุงูุนููู", "ุงูุชูุงุนู"]},
            79: {"name": "ุงูุนููุงุก ุญุณุจ ุงูููุงุฉ", "cols": ["ุงูููุงุฉ", "ุงูุนููู"]},
            80: {"name": "ุงูุนููุงุก ุญุณุจ ุงูููุชุฌุงุช ุงููุดุชุฑูุฉ", "cols": ["ุงูุนููู", "ุงูููุชุฌ"]}
        }
    },
    "ุงููุฌููุนุฉ 9: ุชุญููู ุงูุชุณููู ุงูุฃุณุงุณู": {
        "range": (81, 90),
        "analyses": {
            81: {"name": "ุนุฏุฏ ุงูุฒูุงุฑ ุงูููู", "cols": ["ุนุฏุฏ_ุงูุฒูุงุฑ"]},
            82: {"name": "ุงูุฒูุงุฑ ุญุณุจ ุงููุตุฏุฑ", "cols": ["ุงููุตุฏุฑ", "ุนุฏุฏ_ุงูุฒูุงุฑ"]},
            83: {"name": "ุงูุฒูุงุฑ ุญุณุจ ุงูููุงุฉ", "cols": ["ุงูููุงุฉ", "ุนุฏุฏ_ุงูุฒูุงุฑ"]},
            84: {"name": "ูุนุฏู ุงูููุฑ CTR", "cols": ["ุนุฏุฏ_ุงูุฒูุงุฑ", "ุงูููุฑุงุช"]},
            85: {"name": "ูุนุฏู ุงูุชุญููู", "cols": ["ุนุฏุฏ_ุงูุฒูุงุฑ", "ุงูุชุญูููุงุช"]},
            86: {"name": "ูุนุฏู ุงูุงุฑุชุฏุงุฏ", "cols": ["ูุนุฏู_ุงูุงุฑุชุฏุงุฏ"]},
            87: {"name": "ุงููุดุชุฑููู ุงูุฌุฏุฏ", "cols": ["ุงูุชุงุฑูุฎ", "ุนุฏุฏ_ุงูุฒูุงุฑ"]},
            88: {"name": "ุงููุดุชุฑููู ุงููุดุทูู", "cols": ["ุนุฏุฏ_ุงูุฒูุงุฑ", "ุงูุชุญูููุงุช"]},
            89: {"name": "ุงููุดุชุฑููู ุบูุฑ ุงููุดุทูู", "cols": ["ุนุฏุฏ_ุงูุฒูุงุฑ", "ุงูุชุญูููุงุช"]},
            90: {"name": "ุงูุญููุงุช ุงูุฅุนูุงููุฉ ุงูุฃูุซุฑ ูุนุงููุฉ", "cols": ["ุงูุญููุฉ", "ุงูุชุญูููุงุช"]}
        }
    },
    "ุงููุฌููุนุฉ 10: ุชุญููู ุงูุชุณููู ุงููุชูุฏู": {
        "range": (91, 100),
        "analyses": {
            91: {"name": "ุชูููุฉ ุงูุงูุชุณุงุจ ููู ุนููู", "cols": ["ุงูุชูููุฉ", "ุงูุชุญูููุงุช"]},
            92: {"name": "ุงูุนุงุฆุฏ ุนูู ุงูุงุณุชุซูุงุฑ ุงูุฅุนูุงูู", "cols": ["ุงูุชูููุฉ", "ุงูุฅูุฑุงุฏุงุช"]},
            93: {"name": "ุงูุฅูุฑุงุฏุงุช ุญุณุจ ุงูููุงุฉ", "cols": ["ุงูููุงุฉ", "ุงูุฅูุฑุงุฏุงุช"]},
            94: {"name": "ุงูุฅูุฑุงุฏุงุช ุญุณุจ ุงูุญููุฉ", "cols": ["ุงูุญููุฉ", "ุงูุฅูุฑุงุฏุงุช"]},
            95: {"name": "ุงูุฅูุฑุงุฏุงุช ุญุณุจ ุงููุฆุฉ", "cols": ["ุงููุฆุฉ", "ุงูุฅูุฑุงุฏุงุช"]},
            96: {"name": "ุชุญููู ุงูุชูุงุนู ุญุณุจ ุงููุญุชูู", "cols": ["ุงููุญุชูู", "ุงูุชูุงุนู"]},
            97: {"name": "ุชุญููู ุงูุชูุงุนู ุญุณุจ ุงูุฒูุงู", "cols": ["ุงูุชุงุฑูุฎ", "ุงูุชูุงุนู"]},
            98: {"name": "ุชุญููู ุงูุชูุงุนู ุญุณุจ ุงูููุงุฉ", "cols": ["ุงูููุงุฉ", "ุงูุชูุงุนู"]},
            99: {"name": "ุชููุน ุงูุญููุงุช ุงูุฅุนูุงููุฉ ุงููุงุฏูุฉ", "cols": ["ุงูุญููุฉ", "ุงูุชุญูููุงุช", "ุงูุชุงุฑูุฎ"]},
            100: {"name": "ุชุญููู ุงููุจูุนุงุช ุงููุงุชุฌุฉ ุนู ุงูุญููุงุช", "cols": ["ุงูุญููุฉ", "ุงูุฅูุฑุงุฏุงุช"]}
        }
    }
}

# ุฅุถุงูุฉ ุจุงูู ุงููุฌููุนุงุช ูู 11 ุฅูู 32
ADDITIONAL_GROUPS = {
    "ุงููุฌููุนุฉ 11: ุชุญููู ุงูุทูุงุจ ุงูุฃุณุงุณู": {
        "range": (101, 110),
        "analyses": {i: {"name": f"ุชุญููู {i}", "cols": ["ุงูุทุงูุจ", "ุงูุตู", "ุงูุฏุฑุฌุฉ"]} for i in range(101, 111)}
    },
    "ุงููุฌููุนุฉ 12: ุชุญููู ุงูุทูุงุจ ุงููุชูุฏู": {
        "range": (111, 120),
        "analyses": {i: {"name": f"ุชุญููู {i}", "cols": ["ุงูุทุงูุจ", "ุงูุตู", "ุงูุฏุฑุฌุฉ", "ุงููุงุฏุฉ"]} for i in range(111, 121)}
    },
    "ุงููุฌููุนุฉ 13: ุชุญููู ุงููุดุชุฑูุงุช ุงูุฃุณุงุณู": {
        "range": (121, 130),
        "analyses": {i: {"name": f"ุชุญููู {i}", "cols": ["ุงูููุฑุฏ", "ุงูููุชุฌ", "ุงูุชูููุฉ"]} for i in range(121, 131)}
    },
    "ุงููุฌููุนุฉ 14: ุชุญููู ุงููุดุชุฑูุงุช ุงููุชูุฏู": {
        "range": (131, 140),
        "analyses": {i: {"name": f"ุชุญููู {i}", "cols": ["ุงูููุฑุฏ", "ุงูุชูููุฉ", "ุชุงุฑูุฎ_ุงูุชุณููู"]} for i in range(131, 141)}
    },
}

ANALYSIS_GROUPS.update(ADDITIONAL_GROUPS)

# Initialize session state
if 'uploaded_data' not in st.session_state:
    st.session_state.uploaded_data = None
if 'column_mapping' not in st.session_state:
    st.session_state.column_mapping = {}
if 'analysis_results' not in st.session_state:
    st.session_state.analysis_results = []

# Sidebar
with st.sidebar:
    st.header("โ๏ธ ููุญุฉ ุงูุชุญูู")
    
    # ุฑูุน ุงูููู
    uploaded_file = st.file_uploader("๐ ุฑูุน ููู ุงูุจูุงูุงุช", type=['xlsx', 'xls', 'csv'], help="ูุฏุนู Excel ู CSV ุจุงูุนุฑุจู ูุงูุฅูุฌููุฒู")
    
    if uploaded_file:
        try:
            if uploaded_file.name.endswith('.csv'):
                try:
                    df = pd.read_csv(uploaded_file, encoding='utf-8')
                except:
                    df = pd.read_csv(uploaded_file, encoding='latin-1')
            else:
                df = pd.read_excel(uploaded_file, engine='openpyxl')
            
            st.session_state.uploaded_data = df
            st.success(f"โ ุชู ุงูุชุญููู: {len(df)} ุตู")
            
            with st.expander("๐๏ธ ูุนุงููุฉ ุงูุจูุงูุงุช"):
                st.dataframe(df.head(5), use_container_width=True)
        
        except Exception as e:
            st.error(f"โ ุฎุทุฃ: {str(e)}")
    
    st.markdown("---")
    
    # ุงุฎุชูุงุฑ ุงููุฌููุนุฉ
    if st.session_state.uploaded_data is not None:
        selected_group = st.selectbox("๐ ุงุฎุชุฑ ุงููุฌููุนุฉ", options=list(ANALYSIS_GROUPS.keys()))
        
        # ุงุฎุชูุงุฑ ุงูุชุญููู
        group_data = ANALYSIS_GROUPS[selected_group]
        analysis_options = {v["name"]: k for k, v in group_data["analyses"].items()}
        selected_analysis_name = st.selectbox("๐ ุงุฎุชุฑ ุงูุชุญููู", options=list(analysis_options.keys()))
        selected_analysis_num = analysis_options[selected_analysis_name]
        
        st.markdown("---")
        st.subheader("๐ค ุชูุงุฑูุฑ AI")
        generate_ai_report = st.checkbox("ุชูููุฏ ุชูุฑูุฑ ุฐูู", help="ุณูุชู ุฅูุดุงุก ุชูุฑูุฑ ุชุญูููู ุจุงุณุชุฎุฏุงู AI")

# ุงููุญุชูู ุงูุฑุฆูุณู
if st.session_state.uploaded_data is not None:
    df = st.session_state.uploaded_data
    
    col1, col2, col3, col4 = st.columns(4)
    with col1:
        st.metric("๐ ุนุฏุฏ ุงูุตููู", f"{len(df):,}")
    with col2:
        st.metric("๐ ุนุฏุฏ ุงูุฃุนูุฏุฉ", f"{len(df.columns):,}")
    with col3:
        st.metric("๐พ ุงูุญุฌู", f"{df.memory_usage(deep=True).sum() / 1024:.1f} KB")
    with col4:
        st.metric("โ ุฌุงูุฒ", "ูุนู")
    
    st.markdown("---")
    
    # ูุณู ุฑุจุท ุงูุฃุนูุฏุฉ
    st.subheader("๐ ุฑุจุท ุฃุนูุฏุฉ ุงูุจูุงูุงุช")
    st.info("๐ ูู ูุถููุ ูู ุจุฑุจุท ุฃุนูุฏุฉ ูููู ูุน ุงูุฃุนูุฏุฉ ุงููุทููุจุฉ ููุชุญููู")
    
    required_cols = ANALYSIS_GROUPS[selected_group]["analyses"][selected_analysis_num]["cols"]
    
    col_map = {}
    cols = st.columns(min(3, len(required_cols)))
    
    for idx, req_col in enumerate(required_cols):
        with cols[idx % len(cols)]:
            user_col = st.selectbox(
                f"๐ท๏ธ {req_col}",
                options=["-- ุงุฎุชุฑ --"] + list(df.columns),
                key=f"map_{req_col}_{selected_analysis_num}",
                help=f"ุงุฎุชุฑ ุงูุนููุฏ ุงูููุงุจู ูู {req_col}"
            )
            if user_col != "-- ุงุฎุชุฑ --":
                col_map[req_col] = user_col
    
    st.markdown("---")
    
    # ุฒุฑ ุงูุชูููุฐ
    if st.button("๐ ุชูููุฐ ุงูุชุญููู", type="primary", use_container_width=True):
        if len(col_map) != len(required_cols):
            st.error("โ๏ธ ูุฑุฌู ุฑุจุท ุฌููุน ุงูุฃุนูุฏุฉ ุงููุทููุจุฉ")
        else:
            try:
                st.subheader(f"๐ ูุชุงุฆุฌ: {selected_analysis_name}")
                
                # ุฅูุดุงุก DataFrame ูุคูุช ุจุงูุฃุนูุฏุฉ ุงููุฑุจูุทุฉ
                temp_df = df.copy()
                for req_col, user_col in col_map.items():
                    temp_df[req_col] = df[user_col]
                
                # ุชูููุฐ ุงูุชุญููู ุญุณุจ ุงูุฑูู
                if 1 <= selected_analysis_num <= 10:
                    if selected_analysis_num == 1:
                        total = (temp_df['ุงููููุฉ'] * temp_df['ุณุนุฑ_ุงูุจูุน']).sum()
                        st.metric("๐ฐ ุฅุฌูุงูู ุงููุจูุนุงุช", f"{total:,.2f}")
                        result_data = {"type": "metric", "value": total, "label": "ุฅุฌูุงูู ุงููุจูุนุงุช"}
                    
                    elif selected_analysis_num == 2:
                        profit = ((temp_df['ุณุนุฑ_ุงูุจูุน'] - temp_df['ุงูุชูููุฉ']) * temp_df['ุงููููุฉ']).sum()
                        st.metric("๐ต ุฅุฌูุงูู ุงูุฃุฑุจุงุญ", f"{profit:,.2f}")
                        result_data = {"type": "metric", "value": profit, "label": "ุฅุฌูุงูู ุงูุฃุฑุจุงุญ"}
                    
                    elif selected_analysis_num == 3:
                        top = temp_df.groupby('ุงูููุชุฌ').apply(lambda x: (x['ุงููููุฉ'] * x['ุณุนุฑ_ุงูุจูุน']).sum()).nlargest(10)
                        fig = px.bar(x=top.values, y=top.index, orientation='h', title="ุฃูุถู 10 ููุชุฌุงุช", 
                                   labels={'x': 'ุงููุจูุนุงุช', 'y': 'ุงูููุชุฌ'})
                        fig.update_layout(height=500)
                        st.plotly_chart(fig, use_container_width=True)
                        result_data = {"type": "chart", "data": top.to_dict()}
                    
                    elif selected_analysis_num == 4:
                        bottom = temp_df.groupby('ุงูููุชุฌ').apply(lambda x: (x['ุงููููุฉ'] * x['ุณุนุฑ_ุงูุจูุน']).sum()).nsmallest(10)
                        fig = px.bar(x=bottom.values, y=bottom.index, orientation='h', title="ุฃูู 10 ููุชุฌุงุช",
                                   labels={'x': 'ุงููุจูุนุงุช', 'y': 'ุงูููุชุฌ'}, color_discrete_sequence=['#FF6B6B'])
                        fig.update_layout(height=500)
                        st.plotly_chart(fig, use_container_width=True)
                        result_data = {"type": "chart", "data": bottom.to_dict()}
                    
                    elif selected_analysis_num == 5:
                        by_region = temp_df.groupby('ุงูููุทูุฉ').apply(lambda x: (x['ุงููููุฉ'] * x['ุณุนุฑ_ุงูุจูุน']).sum())
                        fig = px.pie(values=by_region.values, names=by_region.index, title="ุงููุจูุนุงุช ุญุณุจ ุงูููุทูุฉ")
                        fig.update_layout(height=500)
                        st.plotly_chart(fig, use_container_width=True)
                        result_data = {"type": "chart", "data": by_region.to_dict()}
                    
                    elif selected_analysis_num == 6:
                        by_cat = temp_df.groupby('ุงููุฆุฉ').apply(lambda x: (x['ุงููููุฉ'] * x['ุณุนุฑ_ุงูุจูุน']).sum())
                        fig = px.bar(x=by_cat.index, y
