# ============================================================
# ๐ฅ ูุธุงู ุชุญููู ุจูุงูุงุช ุงููุจูุนุงุช + ุชูุฑูุฑ AI ูุงูู + ูุฎุชุตุฑ
# ๐ฅ ูุฏุนู ุนุฑุจู + ุฅูุฌููุฒู โ OOP โ ูููู โ ููุฏ ูุงุญุฏ
# ============================================================

import pandas as pd
import numpy as np
import re
import matplotlib.pyplot as plt
import warnings
warnings.filterwarnings("ignore")

# ============================================================
# ๐ ููุงุณ ุชุญููู ุงููููุงุช
# ============================================================
class DataLoader:
    def load_file(self):
        print("\n๐ ุงุฎุชุฑ ููุน ุงูููู:")
        print("1. Excel")
        print("2. CSV")
        file_type = input("โก ุฅุฏุฎุงู: ")

        file_path = input("\n๐ ุงูุชุจ ูุณุงุฑ ุงูููู: ").strip()

        if file_type == "1":
            return pd.read_excel(file_path)
        elif file_type == "2":
            return pd.read_csv(file_path)
        else:
            print("โ ููุน ุงูููู ุฎุทุฃ")
            return None

# ============================================================
# ๐ ููุงุณ ุชูุธูู ุงูุจูุงูุงุช
# ============================================================
class DataCleaner:
    def __init__(self, df):
        self.df = df

    def clean(self):
        print("\n๐งน ุจุฏุก ุชูุธูู ุงูุจูุงูุงุช...")

        # ุฅุฒุงูุฉ ุงูุฃุนูุฏุฉ ุงููุงุฑุบุฉ
        self.df.dropna(axis=1, how='all', inplace=True)

        # ุฅุฒุงูุฉ ุงูุตููู ุงููุงุฑุบุฉ
        self.df.dropna(axis=0, how='all', inplace=True)

        # ุฅุตูุงุญ ุฃุณูุงุก ุงูุฃุนูุฏุฉ
        self.df.columns = [col.strip().replace(" ", "_") for col in self.df.columns]

        # ุงุณุชุจุฏุงู ุงูููู ุงูุบุฑูุจุฉ
        self.df.replace(["-", "--", "N/A", "NA", "null"], np.nan, inplace=True)

        # ุชุญููู ุงูุฃุนูุฏุฉ ุงูุฑูููุฉ
        for col in self.df.columns:
            if self.df[col].dtype == "object":
                if self.df[col].str.replace(".", "", 1).str.isdigit().sum() > 0:
                    self.df[col] = pd.to_numeric(self.df[col], errors="ignore")

        print("โ ุชู ุชูุธูู ุงูุจูุงูุงุช ุจูุฌุงุญ")
        return self.df

# ============================================================
# ๐ ููุงุณ ุงูุชุญููู
# ============================================================
class SalesAnalyzer:

    def __init__(self, df):
        self.df = df

    def ask_columns(self):
        print("\n๐ ุงูุชุจ ุฃุณูุงุก ุงูุฃุนูุฏุฉ ุงููุทููุจุฉ (ุนุฑุจู ุฃู ุฅูุฌููุฒู):")
        self.col_product = input("๐น ุนููุฏ ุงูููุชุฌ: ")
        self.col_sales = input("๐น ุนููุฏ ุงููุจูุนุงุช: ")
        self.col_profit = input("๐น ุนููุฏ ุงูุฑุจุญ: ")
        self.col_date = input("๐น ุนููุฏ ุงูุชุงุฑูุฎ: ")
        self.col_customer = input("๐น ุนููู (ุงุฎุชูุงุฑู): ")
        self.col_region = input("๐น ุงูููุทูุฉ (ุงุฎุชูุงุฑู): ")

    # ------------------------- ุชุญููู ูุงูู -------------------------
    def full_analysis(self):
        report = {}

        # ุฅุฌูุงูู ุงููุจูุนุงุช
        report["total_sales"] = self.df[self.col_sales].sum()

        # ุฅุฌูุงูู ุงูุฃุฑุจุงุญ
        report["total_profit"] = self.df[self.col_profit].sum()

        # ุฃูุถู ุงูููุชุฌุงุช
        report["top_products"] = (
            self.df.groupby(self.col_product)[self.col_sales].sum().sort_values(ascending=False).head(5)
        )

        # ุฃุณูุฃ ุงูููุชุฌุงุช
        report["worst_products"] = (
            self.df.groupby(self.col_product)[self.col_sales].sum().sort_values().head(5)
        )

        # ุงูุฑุจุญูุฉ
        report["top_profit_products"] = (
            self.df.groupby(self.col_product)[self.col_profit].sum().sort_values(ascending=False).head(5)
        )

        # ุชุญููู ุดูุฑู
        df_date = self.df.copy()
        df_date[self.col_date] = pd.to_datetime(df_date[self.col_date], errors="coerce")
        df_date["month"] = df_date[self.col_date].dt.to_period("M").astype(str)

        report["monthly_sales"] = (
            df_date.groupby("month")[self.col_sales].sum()
        )

        return report

    # ------------------------- ุชูุฑูุฑ AI ุดุงูู -------------------------
    def generate_ai_full(self, report):
        text = f"""
===============================
๐ AI FULL SMART REPORT
===============================

๐ **ุฅุฌูุงูู ุงููุจูุนุงุช:** {report['total_sales']:,}
๐ **ุฅุฌูุงูู ุงูุฃุฑุจุงุญ:** {report['total_profit']:,}

-------------------------------
๐ฅ ุฃูุถู ุงูููุชุฌุงุช:
{report['top_products']}

-------------------------------
โ๏ธ ุฃุณูุฃ ุงูููุชุฌุงุช:
{report['worst_products']}

-------------------------------
๐ฐ ุฃูุซุฑ ุงูููุชุฌุงุช ุฑุจุญูุฉ:
{report['top_profit_products']}

-------------------------------
๐ ุงููุจูุนุงุช ุงูุดูุฑูุฉ:
{report['monthly_sales']}

===============================
๐ฏ ุชุญููู ุงูุฐูุงุก ุงูุงุตุทูุงุนู:
===============================

โ ุงูููุชุฌุงุช ุงูุฃุนูู ูุจูุนูุง ูุฌุจ ุฏุนููุง ุจูุฎุฒูู ุฃูุจุฑ + ุญููุงุช ุชุณููู.  
โ ุงูููุชุฌุงุช ุงูุถุนููุฉ ูุฏ ุชุญุชุงุฌ ุชุฎููุถุงุช ุฃู ุฅุนุงุฏุฉ ุชุณุนูุฑ.  
โ ุฅุฐุง ูุงู ููุงู ุชุฐุจุฐุจ ุดูุฑู โ ุฑุงุฌุน ููุณููุฉ ุงูุณูู + ุงูุนุฑูุถ.  
โ ุฅุฐุง ูุงูุช ุงูุฃุฑุจุงุญ ููุฎูุถุฉ ุฑุบู ุงููุจูุนุงุช ุงูุนุงููุฉ โ ูุดููุฉ ุชุณุนูุฑ ุฃู ุชูููุฉ ุนุงููุฉ.  
โ ุฅุฐุง ูุงูุช ูุชุฑุงุช ุงูุฑููุฏ ูุซูุฑุฉ โ ุฌุฑูุจ ุนุฑูุถ Flash Sale.  

===============================
๐ ุชูุตูุงุช ูุชุญุณูู ุงูุฃุฏุงุก:
===============================

1๏ธโฃ ุฑููุฒ ุนูู ุงูููุชุฌุงุช ุงูุฃุนูู ุฃุฑุจุงุญูุง ูููุณ ููุท ุงูุฃุนูู ูุจูุนูุง.  
2๏ธโฃ ุงุทูู Bundle Offers ูุฒูุงุฏุฉ ูุชูุณุท ุงููุงุชูุฑุฉ.  
3๏ธโฃ ุงุณุชุฎุฏู Cross-selling ูู ุงูููุชุฌุงุช ุงููุฑูุจุฉ.  
4๏ธโฃ ุญุณูู ุงููุฎุฒูู ููููุชุฌุงุช ุงููุทููุจุฉ ูุจู ุฃู ุชููุฏ.  
5๏ธโฃ ุฑุงูุจ ุงูุงุชุฌุงู ุงูุดูุฑู ููุนุฑูุฉ ูุชุฑุงุช ุงูุฐุฑูุฉ ูุงูุถุนู.  
"""
        return text

    # ------------------------- ุชูุฑูุฑ AI ูุฎุชุตุฑ -------------------------
    def generate_ai_short(self, report):
        text = f"""
===============================
๐ EXECUTIVE SUMMARY (SHORT)
===============================

โ ุฅุฌูุงูู ุงููุจูุนุงุช: {report['total_sales']:,}  
โ ุฅุฌูุงูู ุงูุฃุฑุจุงุญ: {report['total_profit']:,}

๐ฅ ุฃูู 3 ูุฑุต:
1. ุฏุนู ุงูููุชุฌุงุช ุงูุฃุนูู ูุจูุนูุง ุจูุฎุฒูู ุฅุถุงูู.
2. ุฅุนุงุฏุฉ ุชุณุนูุฑ ุงูููุชุฌุงุช ุงูุถุนููุฉ.
3. ุฒูุงุฏุฉ ุงูููุงูุด ุนูู ุงูููุชุฌุงุช ุฐุงุช ุงูุทูุจ ุงูุนุงูู.

โ ุฃูู 3 ูุดุงูู:
1. ููุชุฌุงุช ุจุทูุฆุฉ ุงูุญุฑูุฉ.
2. ุชุฐุจุฐุจ ูุจูุนุงุช ุดูุฑู.
3. ุฃุฑุจุงุญ ููุฎูุถุฉ ูููุชุฌุงุช ุนุงููุฉ ุงูุจูุน.

๐ ุฃูู 3 ุญููู:
1. ุนุฑูุถ ููููุชุฌุงุช ุงูุฑุงูุฏุฉ.
2. ุญููุงุช ุงุณุชูุฏุงู ููุนููุงุก ุงูููุฑุฑูู.
3. ูุฑุงูุจุฉ ุณูุณูุฉ ุงูุชูุฑูุฏ ูุชุญุณูู ุงููุฎุฒูู.
"""
        return text

# ============================================================
# ๐ ุงููููู ุงูุฑุฆูุณูุฉ
# ============================================================
class MainMenu:

    def run(self):

        print("\n==============================")
        print("๐ ูุธุงู ุชุญููู ุจูุงูุงุช ูุจูุนุงุช ูุงูู + AI")
        print("==============================")

        # ุชุญููู ุงูููู
        loader = DataLoader()
        df = loader.load_file()

        if df is None:
            return

        # ุชูุธูู
        cleaner = DataCleaner(df)
        df = cleaner.clean()

        # ุชุญููู
        analyzer = SalesAnalyzer(df)
        analyzer.ask_columns()
        report = analyzer.full_analysis()

        # ุนุฑุถ ุงุฎุชูุงุฑุงุช AI
        print("\n๐ค ุงุฎุชุฑ ููุน ุงูุชูุฑูุฑ:")
        print("1. ุชูุฑูุฑ AI ูุงูู")
        print("2. ุชูุฑูุฑ AI ูุฎุชุตุฑ")
        print("3. ุงูุงุซููู ูุนุงู")

        choice = input("โก ุฅุฏุฎุงู: ")

        if choice == "1":
            print(analyzer.generate_ai_full(report))

        elif choice == "2":
            print(analyzer.generate_ai_short(report))

        else:
            print(analyzer.generate_ai_full(report))
            print("\n---------------------------------\n")
            print(analyzer.generate_ai_short(report))

# ============================================================
# ๐ ุชุดุบูู ุงูุจุฑูุงูุฌ
# ============================================================
if __name__ == "__main__":
    MainMenu().run()
